<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>IM页面</title>
    <link rel="stylesheet" href="./js/common/mCustomScrollbar/jquery.mCustomScrollbar.min.css">
    <link rel="stylesheet" type="text/css" href="style/im/im.css">
</head>
<body>
<!-- jjs IM -->
<div class="jjsim im-fold">
  	<div class="jjsim-shandow clearfix">
    	<div class="jjsim-wrap">
      		<div class="jjsim-hd">
		        <span data-role="im-title">咨询经纪人</span>
		        <span class="jjsim-hd-num" data-unread="0">7</span>
		        <a class="jjsim-hd-closebtn" title="收起"></a>
		    </div>
	      	<div class="jjsim-bd">
	        	<ul class="jjsim-service">
	          		<li class="jjsim-bd-item">
             			<div class="jjsim-item-img">
             				<img src="images/im/jjs.png">
             			</div>
             			<span class="name" title="家家顺客服">家家顺客服</span>
             			<span class="text" title="用心只为您顺心">用心只为您顺心</span>
	          		</li>
	        	</ul>
	        	<ul class="jjsim-list" id="jjsim-list" >
	        		<li class="jjsim-bd-item">
             			<div class="jjsim-item-img">
             				<img src="images/im/jjs.png">
             			</div>
             			<span class="name" title="家家顺客服">家家顺客服</span>
             			<span class="text" title="用心只为您顺心">用心只为您顺心</span>
             			<span class="time" title="12:10">12:10</span>
	          		</li>
	        		<li class="jjsim-bd-item">
             			<div class="jjsim-item-img">
             				<img src="images/im/person.jpg">
             			</div>
             			<em class="num" title="3">3</em>
             			<span class="name" title="李芳">李芳</span>
             			<span class="text" title="啥时候有空来看看">啥时候有空来看看</span>
             			<span class="time" title="昨天 12:10">昨天 12:10</span>
	          		</li>
	          		<li class="jjsim-bd-item">
             			<div class="jjsim-item-img">
             				<img src="images/im/person.jpg">
             			</div>
             			<span class="name" title="李芳">李芳</span>
             			<span class="text" title="这套房子满五年，差不多可以马上出售">这套房子满五年，差不多可以马上出售</span>
             			<span class="time" title="12:10">12:10</span>
	          		</li>
	        	</ul>
		        <div class="jjsim-noagent">
		        	<p>没有咨询过的经纪人</p>
		        	<p><a href="javascript:;">登录</a>后获取更多</p>        
		        </div>
	    	</div>
		</div>
		<!-- 聊天面板 -->
	    <div class="jjsim-window im-online" data-agentid="1">
			<div class="jjsim-wintitle">
				<span class="im-wt-name">李芳</span>
				<a class="im-wt-closebtn" title="关闭"></a>
			</div>
			<div class="jjsim-wincont">
				<div class="im-wc-chat">
					<p class="chat-tophint">在线咨询时间：周一至周六 09:00-19:00<a class="chat-tophint-closebtn" title="关闭"></a></p>
					<ul class="im-chat-content clearfix">
						<li class="im-msg-item im-msg-more">
							<a href="javascript:;" class="imchat-more-btn">点击加载更多咨询记录</a>
							<img src="images/im/loading.gif" class="imchat-loading" />
						</li>
						<li class="im-msg-item im-msg-time">
							<p class="chat-time">15:30</p>
						</li>
						<li class="im-msg-item im-msg-left">
							<div class="msg-img">
								<img src="images/im/person.jpg">
							</div>
							<div class="msg-text">
								<span class="text">这套房子满五年，差不多可以马上出售</span>
							</div>
						</li>
						<li class="im-msg-item im-msg-right im-msg-link">
							<div class="msg-img">
								<img src="images/im/person.jpg">
							</div>
							<div class="msg-text">
								<a class="text" href="#" target="_blank">
									<div class="link-item-img">
			             				<img src="images/im/img.png">
			             			</div>
			             			<span class="link-span link-title" title="旭飞花园 一房一厅一室一卫">旭飞花园 一房一厅一室一卫</span>
			             			<span class="link-span  link-attr" title="啥时候有空来看看"><em>三房两厅</em><em>108m²</em><em>精装修</em><em>朝阳</em></span>
			             			<span class="link-span link-price" title="昨天 12:10"><em>155</em>万</span>
		             			</a>
							</div>
						</li>
						<li class="im-msg-item im-msg-right">
							<div class="msg-img">
								<img src="images/im/person.jpg">
							</div>
							<div class="msg-text">
								<span class="text">这套房子满五年，差不多可以马上出售</span>
								<i class="msg-warning" title="发送失败"></i>
							</div>
						</li>
						<li class="im-msg-item im-msg-tip">
							<span class="msg-tip-error">发送失败</span>
						</li>
					</ul>
				</div>
				<div class="im-wc-input">
					<div class="im-input-container">
						<textarea name="im-msg-content" id="im-msg-content" placeholder="输入您要咨询的内容"></textarea>
						<a class="im-upload-img" id="openUpload" title="选择图片"></a>
						<span class="im-errorlog"><!-- 填写有误填写有误填写有误 --></span>
					</div>
					<div class="im-btn-container">
						<a href="/common/app/download" target="_blank" title="下载家家顺APP">立即下载家家顺APP，随时随地，想聊就聊</a>
						<a href="javascript:;" class="btn send">发送</a>
					</div>
				</div>
			</div>
	    </div>
  	</div>
</div>
<script src="./js/jquery-min.js"></script>
<script src="./js/common/mCustomScrollbar/jquery.mCustomScrollbar.concat.min.js"></script>
<script type="text/javascript">
    (function () {
    	var isLogin = true,
    		isIE7 = $.browser.msie && $.browser.version =="7.0";
    	/* 如果已经登录 */
    	if(isLogin){
    		$(".jjsim-noagent").hide();
    		$(".jjsim-service").hide();
    		$(".jjsim-list").show();
    	}
    	if(isIE7){
			$(".jjsim-shandow").css("width","237px");
		}
    	/* 展开、收起咨询经纪人 */
    	$(".jjsim-hd").click(function(){
    		$(".jjsim").toggleClass("im-fold");
    		$(".jjsim-window").hide();
    		if(isIE7){
    			$(".jjsim-shandow").css("width","237px");
    		}
    	});

    	/*  */
    	$(".jjsim-list").on("click",".jjsim-bd-item",function(){
    		$(".jjsim-window").show();
    		if(isIE7){
    			$(".jjsim-shandow").css("width","618px");
    		}
    	});

    	/* 关闭聊天窗口 */
    	$(".im-wt-closebtn").click(function(){
    		$(".jjsim-window").hide();
    		if(isIE7){
    			$(".jjsim-shandow").css("width","237px");
    		}
    	});

    	/* 关闭时间提示 */
    	$(".chat-tophint-closebtn").click(function(){
    		$(this).parent().remove();
    		$(".im-wc-chat ul").css({"height": "265px","padding-top":"0"});
    	});

    	/* 添加滚动条事件 */
    	$(".jjsim-bd").mCustomScrollbar({theme:"dark"});
		$(".im-wc-chat ul").mCustomScrollbar({
			theme:"dark",
			setTop:"32px",
			scrollSpeed:30,
			callbacks:{
				onInit:function(){
					$(".im-wc-chat ul").mCustomScrollbar("scrollTo","bottom",{
					    scrollInertia:1
					});
				}
			}
		});

		$(".imchat-more-btn").click(function(){
			$(this).hide();
			$(".imchat-loading").show();
			// 请求查看更多
			setTimeout(function(){
				var more = '<li class="im-msg-item im-msg-right">'+
					'<div class="msg-img">'+
						'<img src="images/im/person.jpg">'+
					'</div>'+
					'<div class="msg-text">'+
						'<span class="text">这是加载的内容</span>'+
					'</div>'+
				'</li>'+
				'<li class="im-msg-item im-msg-left">'+
					'<div class="msg-img">'+
						'<img src="images/im/person.jpg">'+
					'</div>'+
					'<div class="msg-text">'+
						'<span class="text">这是加载的内容</span>'+
					'</div>'+
				'</li>';
				$(".imchat-loading").hide();
				$(".im-msg-more").after(more);
				$(".imchat-more-btn").show();
			},3000);
		});

		/* 发送信息内容 */
		$(".send").click(function(){
			var text = $.trim($("#im-msg-content").val());
			if(text){
				var li = '<li class="im-msg-item im-msg-right">'+
					'<div class="msg-img">'+
						'<img src="images/im/person.jpg">'+
					'</div>'+
					'<div class="msg-text">'+
						'<span class="text">'+text+'</span>'+
					'</div>'+
				'</li>';
				$(".im-chat-content .mCSB_container").append(li);
				$("#im-msg-content").val("");
				$(".im-wc-chat ul").mCustomScrollbar("scrollTo","bottom",{
				    scrollInertia:10
				});
			}else{
				$(".im-errorlog").text("请输入内容");
			}
		});
    })();
</script>
</body>